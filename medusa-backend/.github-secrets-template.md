# GitHub Secrets Configuration Template

Copy this template and configure all secrets in your GitHub repository settings.

## Navigation
Go to: Repository → Settings → Secrets and variables → Actions → New repository secret

---

## SSH Configuration

### VPS_SSH_PRIVATE_KEY
```
-----BEGIN OPENSSH PRIVATE KEY-----
[Your SSH private key content]
-----END OPENSSH PRIVATE KEY-----
```

**How to generate:**
```bash
ssh-keygen -t ed25519 -C "github-actions@your-domain.com"
# Copy the content of the private key
cat ~/.ssh/id_ed25519
# Add the public key to VPS ~/.ssh/authorized_keys
cat ~/.ssh/id_ed25519.pub
```

### VPS_HOST
```
102.68.86.157
```

### VPS_USER
```
ubuntu
```
*(Replace with your actual VPS username)*

---

## Staging Environment Secrets

### MEDUSA_DATABASE_URL_staging
```
postgresql://postgres:YOUR_PASSWORD@db.wxniywyujrxlwraocszi.supabase.co:5432/postgres?schema=medusa_staging
```

**Find this in:**
Supabase Dashboard → Project Settings → Database → Connection string (URI)

**Important:** Create a separate schema called `medusa_staging`

### MEDUSA_JWT_SECRET_staging
```
[Generate using command below]
```

**Generate:**
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### MEDUSA_COOKIE_SECRET_staging
```
[Generate using command below]
```

**Generate:**
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### MEDUSA_STORE_CORS_staging
```
https://your-staging-domain.lovable.app,http://localhost:5173
```

**Replace:**
- `your-staging-domain.lovable.app` with your actual Lovable staging URL

### MEDUSA_ADMIN_CORS_staging
```
https://your-staging-domain.lovable.app,http://localhost:9001
```

---

## Production Environment Secrets

### MEDUSA_DATABASE_URL_production
```
postgresql://postgres:YOUR_PASSWORD@db.wxniywyujrxlwraocszi.supabase.co:5432/postgres?schema=medusa_production
```

**Important:** 
- Use the same Supabase instance OR create a new Supabase project for production
- Create a separate schema called `medusa_production`

### MEDUSA_JWT_SECRET_production
```
[Generate using command - MUST BE DIFFERENT from staging]
```

**Generate:**
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### MEDUSA_COOKIE_SECRET_production
```
[Generate using command - MUST BE DIFFERENT from staging]
```

**Generate:**
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### MEDUSA_STORE_CORS_production
```
https://your-production-domain.com,https://www.your-production-domain.com
```

**Replace:**
- `your-production-domain.com` with your actual production domain

### MEDUSA_ADMIN_CORS_production
```
https://your-production-domain.com,https://www.your-production-domain.com
```

---

## Shared Secrets

### MEDUSA_REDIS_URL
```
redis://localhost:6379
```

*(This is the same for both staging and production since Redis runs on the VPS)*

---

## Verification Checklist

After adding all secrets, verify:

- [ ] VPS_SSH_PRIVATE_KEY is added
- [ ] VPS_HOST is `102.68.86.157`
- [ ] VPS_USER matches your VPS username
- [ ] MEDUSA_DATABASE_URL_staging points to staging schema
- [ ] MEDUSA_DATABASE_URL_production points to production schema
- [ ] MEDUSA_JWT_SECRET_staging and MEDUSA_JWT_SECRET_production are different
- [ ] MEDUSA_COOKIE_SECRET_staging and MEDUSA_COOKIE_SECRET_production are different
- [ ] MEDUSA_STORE_CORS_staging includes your Lovable staging URL
- [ ] MEDUSA_STORE_CORS_production includes your production domain
- [ ] MEDUSA_ADMIN_CORS_staging includes your Lovable staging URL
- [ ] MEDUSA_ADMIN_CORS_production includes your production domain
- [ ] MEDUSA_REDIS_URL is `redis://localhost:6379`

---

## Security Notes

1. **Never commit secrets to Git**
2. **Use different secrets for staging and production**
3. **Rotate secrets periodically (every 90 days recommended)**
4. **Limit access to GitHub repository secrets**
5. **Use strong, randomly generated secrets (min 32 characters)**

---

## Testing the Setup

After configuring all secrets:

1. Push a small change to `medusa-backend/README.md` in the staging branch
2. Go to GitHub Actions → Deploy Medusa Backend
3. Watch the workflow run
4. Verify deployment succeeds
5. Test the health endpoint: `http://102.68.86.157:9001/health`

If deployment fails, check:
- GitHub Actions logs for error messages
- SSH connectivity to VPS
- Database connectivity from VPS
- PM2 logs on VPS
